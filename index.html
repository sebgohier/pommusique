<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Interface Professeur - POM Musique</title>
<style>
  body { margin:0; font-family:Arial,sans-serif; display:flex; height:100vh; }
  .sidebar {
    width:220px; background: linear-gradient(to bottom,#ffb629,#000000); color:white;
    display:flex; flex-direction:column; align-items:center; padding-top:20px;
  }
  .sidebar img { width:150px; margin-bottom:30px; }
  .menu-item {
    width:90%; padding:12px 10px; margin:5px 0; border-radius:8px;
    cursor:pointer; display:flex; align-items:center; transition: background 0.3s;
    font-size:16px; background-color:#ccc; color:#000;
  }
  .menu-item:hover { background-color:#bbb; }
  .menu-item span { margin-left:10px; }
  .content { flex:1; padding:20px; background-color:#f9f9f9; overflow-y:auto; }
  .section { display:none; }
  input, select { width:100%; box-sizing:border-box; padding:4px; margin:2px 0; }
  button { padding:6px 12px; margin-top:5px; cursor:pointer; }
  table { border-collapse: collapse; width:100%; margin-top:10px; }
  th, td { border:1px solid #000; padding:6px; text-align:center; }
  th { background-color:#f0f0f0; }
</style>
</head>
<body>

<div class="sidebar">
  <img src="https://raw.githubusercontent.com/sebgohier/pommusique/refs/heads/main/Logo%20Pom%20Musique%20noir.png" alt="Logo POM Musique">
  
  <div class="menu-item" onclick="showSection('repertoire')">üìÅ <span>R√©pertoire √©l√®ves</span></div>
  <div class="menu-item" onclick="showSection('planning')">üìÖ <span>Planning</span></div>
  <div class="menu-item" onclick="showSection('heuresSup')">‚è∞ <span>Heures suppl√©mentaires</span></div>
  <div class="menu-item" onclick="showSection('absences')">üìù <span>Absences</span></div>
  <div class="menu-item" onclick="showSection('partitions')">üéº <span>Partitions</span></div>
  <div class="menu-item" onclick="showSection('contacts')">üìû <span>Contacts</span></div>
</div>

<div class="content">
  <!-- R√©pertoire -->
  <div class="section" id="repertoire">
    <h2>R√©pertoire √©l√®ves</h2>
    <p>Contenu du r√©pertoire ici...</p>
  </div>

  <!-- Planning -->
  <div class="section" id="planning">
    <h2>Planning</h2>
    <p>Contenu du planning ici...</p>
  </div>

  <!-- Heures Sup -->
  <div class="section" id="heuresSup">
    <h2>D√©claration Heures Suppl√©mentaires</h2>
    <table id="hsTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Type d‚Äô√©v√©nement</th>
          <th>Heure d√©but</th>
          <th>Heure fin</th>
          <th>Dur√©e</th>
          <th>Lieu</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="4">Total heures</td>
          <td id="totalDuration">0h00</td>
          <td colspan="2"></td>
        </tr>
      </tfoot>
    </table>
    <label>Nom complet du professeur : <input type="text" id="profNameHs" placeholder="Ex: S√©bastien GOHIER"></label>
    <button id="addRowHs">+ Ajouter une ligne</button>
    <button id="sendHs">Envoyer la demande</button>
    <p id="confirmHs" style="color:green;font-weight:bold;"></p>
  </div>

  <!-- Absences -->
  <div class="section" id="absences">
    <h2>Demande d'Absences</h2>
    <table id="absTable">
      <thead>
        <tr>
          <th>Date d'absence</th>
          <th>Cr√©neau absence</th>
          <th>Date de rattrapage</th>
          <th>Cr√©neau rattrapage</th>
          <th>Salle</th>
          <th>Accord √©l√®ve / responsable</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <label>Nom complet du professeur : <input type="text" id="profNameAbs" placeholder="Ex: S√©bastien GOHIER"></label>
    <button id="addRowAbs">+ Ajouter une ligne</button>
    <button id="sendAbs">Envoyer la demande</button>
    <p id="confirmAbs" style="color:green;font-weight:bold;"></p>
  </div>

  <!-- Partitions -->
  <div class="section" id="partitions">
    <h2>Partitions</h2>
    <p>Contenu des partitions ici...</p>
  </div>

  <!-- Contacts -->
  <div class="section" id="contacts">
    <h2>Contacts</h2>
    <p>Contenu des contacts ici...</p>
  </div>
</div>

<script>
// --- Gestion des sections ---
function showSection(section){
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById(section).style.display='block';
}

// --- Heures Sup ---
const typesEvenement=["Concert","R√©p√©tition","Autre"];
function formatDuration(h,m){ return `${h}h${m.toString().padStart(2,'0')}`; }
function calculateDuration(start,end){
  if(!start||!end) return "0h00";
  const [h1,m1]=start.split(":").map(Number);
  const [h2,m2]=end.split(":").map(Number);
  let total=(h2*60+m2)-(h1*60+m1);
  if(total<0) total=0;
  const h=Math.floor(total/60), m=total%60;
  return formatDuration(h,m);
}
function updateDurHs(){
  let totalMins=0;
  document.querySelectorAll("#hsTable tbody tr").forEach(tr=>{
    const start=tr.querySelector(".debut").value;
    const end=tr.querySelector(".fin").value;
    const durCell=tr.querySelector(".duree");
    const dur=calculateDuration(start,end);
    durCell.textContent=dur;
    const [h,m]=dur.split("h").map(Number);
    totalMins+=h*60+m;
  });
  document.getElementById("totalDuration").textContent=formatDuration(Math.floor(totalMins/60),totalMins%60);
}
function addRowHs(data={}) {
  const tbody=document.querySelector("#hsTable tbody");
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td><input type="date" class="date" value="${data.date||''}"></td>
    <td><select class="type">${typesEvenement.map(t=>`<option value="${t}" ${t===data.type?'selected':''}>${t}</option>`).join('')}</select></td>
    <td><input type="time" class="debut" value="${data.debut||''}"></td>
    <td><input type="time" class="fin" value="${data.fin||''}"></td>
    <td class="duree">0h00</td>
    <td><input type="text" class="lieu" value="${data.lieu||''}"></td>
    <td><button type="button" class="deleteBtn">X</button></td>
  `;
  tbody.appendChild(tr);
  tr.querySelector(".debut").addEventListener("input",updateDurHs);
  tr.querySelector(".fin").addEventListener("input",updateDurHs);
  tr.querySelector(".deleteBtn").addEventListener("click",()=>{tr.remove(); updateDurHs();});
  updateDurHs();
}
addRowHs();
document.getElementById("addRowHs").addEventListener("click",()=>addRowHs());
document.getElementById("sendHs").addEventListener("click",()=>{
  const profName=document.getElementById("profNameHs").value.trim();
  if(!profName){ alert("Merci d‚Äôindiquer le nom complet du professeur !"); return; }
  const tbody=document.querySelector("#hsTable tbody");
  if(!tbody.querySelectorAll("tr").length){ alert("Ajoutez au moins une ligne !"); return; }
  const lignes=[];
  tbody.querySelectorAll("tr").forEach(tr=>{
    lignes.push({
      date: tr.querySelector(".date").value,
      type: tr.querySelector(".type").value,
      debut: tr.querySelector(".debut").value,
      fin: tr.querySelector(".fin").value,
      duree: tr.querySelector(".duree").textContent,
      lieu: tr.querySelector(".lieu").value
    });
  });
  const total=document.getElementById("totalDuration").textContent;
  fetch("https://script.google.com/macros/s/AKfycbzHTKad43bRoC2kzLt8mYdkBj9XSWUoEm4tpEG76klzC2QqRiB6EgVK3PD0llK-_x6Z/exec", {
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({nomProf:profName,lignes,total})
  }).then(res=>res.json())
  .then(response=>{
    if(response.status==="success"){
      document.getElementById("confirmHs").textContent=response.message;
      tbody.innerHTML=""; addRowHs(); document.getElementById("profNameHs").value="";
    }else{
      document.getElementById("confirmHs").textContent="Erreur : "+response.message;
    }
  }).catch(err=>{document.getElementById("confirmHs").textContent="Erreur : "+err;});
});

// --- Absences ---
function addRowAbs(data={}) {
  const tbody=document.querySelector("#absTable tbody");
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td><input type="date" class="date" value="${data.date||''}"></td>
    <td><input type="text" class="creneau" value="${data.creneau||''}"></td>
    <td><input type="date" class="dateRattrapage" value="${data.dateRattrapage||''}"></td>
    <td><input type="text" class="creneauRattrapage" value="${data.creneauRattrapage||''}"></td>
    <td><input type="text" class="salle" value="${data.salle||''}"></td>
    <td style="text-align:center;"><input type="checkbox" class="accord" ${data.accord?'checked':''}></td>
    <td><button type="button" class="deleteBtn">X</button></td>
  `;
  tbody.appendChild(tr);
  tr.querySelector(".deleteBtn").addEventListener("click",()=>tr.remove());
}
addRowAbs();
document.getElementById("addRowAbs").addEventListener("click",()=>addRowAbs());
document.getElementById("sendAbs").addEventListener("click",()=>{
  const profName=document.getElementById("profNameAbs").value.trim();
  if(!profName){ alert("Merci d‚Äôindiquer le nom complet du professeur !"); return; }
  const tbody=document.querySelector("#absTable tbody");
  if(!tbody.querySelectorAll("tr").length){ alert("Ajoutez au moins une ligne !"); return; }
  const lignes=[];
  tbody.querySelectorAll("tr").forEach(tr=>{
    lignes.push({
      date: tr.querySelector(".date").value,
      creneau: tr.querySelector(".creneau").value,
      dateRattrapage: tr.querySelector(".dateRattrapage").value,
      creneauRattrapage: tr.querySelector(".creneauRattrapage").value,
      salle: tr.querySelector(".salle").value,
      accord: tr.querySelector(".accord").checked
    });
  });
  fetch("https://script.google.com/macros/s/AKfycbz8JTN0HjVwwbRrFeWgjtIkbl9fe2dXWRYfMRLACpTwWAnN3Ms-OCjl375pX4i37WIjrQ/exec", {
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({nomProf:profName,lignes})
  }).then(res=>res.json())
  .then(response=>{
    if(response.status==="success"){
      document.getElementById("confirmAbs").textContent=response.message;
      tbody.innerHTML=""; addRowAbs(); document.getElementById("profNameAbs").value="";
    }else{
      document.getElementById("confirmAbs").textContent="Erreur : "+response.message;
    }
  }).catch(err=>{document.getElementById("confirmAbs").textContent="Erreur : "+err;});
});
</script>

</body>
</html>
