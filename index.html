<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">

<!-- ‚úÖ CSP permissive pour Google Apps Script -->
<meta http-equiv="Content-Security-Policy"
content="
default-src 'self' 'unsafe-inline' 'unsafe-eval' https://script.google.com https://script.googleusercontent.com;
connect-src https://script.google.com https://script.googleusercontent.com;
img-src * data:;
style-src 'self' 'unsafe-inline';
">

<title>Interface Professeur - POM Musique</title>

<style>
body { margin:0; font-family:Arial,sans-serif; display:flex; height:100vh; }
.sidebar { width:220px; background: linear-gradient(to bottom,#ffb629,#000000); color:white;
display:flex; flex-direction:column; align-items:center; padding-top:20px; }
.sidebar img { width:150px; margin-bottom:30px; }
.menu-item { width:90%; padding:12px 10px; margin:5px 0; border-radius:8px;
cursor:pointer; display:flex; align-items:center; transition: background 0.3s; font-size:16px;
background-color:#ccc; color:#000; }
.menu-item:hover { background-color:#bbb; }
.menu-item span { margin-left:10px; }
.content { flex:1; padding:20px; background-color:#f9f9f9; overflow-y:auto; }
.section { display:none; }
input, select { width:100%; box-sizing:border-box; padding:4px; margin:2px 0; }
button { padding:6px 12px; margin-top:5px; cursor:pointer; }
table { border-collapse: collapse; width:100%; margin-top:10px; }
th, td { border:1px solid #000; padding:6px; text-align:center; }
th { background-color:#f0f0f0; }
</style>
</head>
<body>

<div class="sidebar">
<img src="https://raw.githubusercontent.com/sebgohier/pommusique/refs/heads/main/Logo%20Pom%20Musique%20noir.png" alt="Logo POM Musique">
<div class="menu-item" onclick="showSection('repertoire')">üìÅ <span>R√©pertoire √©l√®ves</span></div>
<div class="menu-item" onclick="showSection('planning')">üìÖ <span>Planning</span></div>
<div class="menu-item" onclick="showSection('heuresSup')">‚è∞ <span>Heures suppl√©mentaires</span></div>
<div class="menu-item" onclick="showSection('absences')">üìù <span>Absences</span></div>
<div class="menu-item" onclick="showSection('partitions')">üéº <span>Partitions</span></div>
<div class="menu-item" onclick="showSection('contacts')">üìû <span>Contacts</span></div>
</div>

<div class="content">

<div class="section" id="repertoire">
<h2>R√©pertoire √©l√®ves</h2>
<p>Contenu du r√©pertoire ici...</p>
</div>

<div class="section" id="planning">
<h2>Planning</h2>
<p>Contenu du planning ici...</p>
</div>

<div class="section" id="heuresSup">
<h2>D√©claration Heures Suppl√©mentaires</h2>
<label>Nom complet du professeur :
<input type="text" id="profNameHs"></label>
<table id="hsTable">
<thead>
<tr>
<th>Date</th><th>Type</th><th>D√©but</th><th>Fin</th><th>Dur√©e</th><th>Lieu</th><th></th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr>
<td colspan="4">Total</td>
<td id="totalDuration">0h00</td>
<td colspan="2"></td>
</tr>
</tfoot>
</table>
<button id="addRowHs">+ Ajouter une ligne</button>
<button id="sendHs">Envoyer</button>
<p id="confirmHs" style="color:green;font-weight:bold"></p>
</div>

<div class="section" id="absences">
<h2>Demande d'Absences</h2>
<label>Nom complet du professeur :
<input type="text" id="profNameAbs"></label>
<table id="absTable">
<thead>
<tr>
<th>Date</th><th>Cr√©neau</th><th>Rattrapage</th><th>Cr√©neau</th><th>Salle</th><th>Accord</th><th></th>
</tr>
</thead>
<tbody></tbody>
</table>
<button id="addRowAbs">+ Ajouter une ligne</button>
<button id="sendAbs">Envoyer</button>
<p id="confirmAbs" style="color:green;font-weight:bold"></p>
</div>

<div class="section" id="partitions"><h2>Partitions</h2></div>
<div class="section" id="contacts"><h2>Contacts</h2></div>

</div>



<script>
document.addEventListener("DOMContentLoaded", () => {

  // --- Affichage des sections ---
  window.showSection = (section) => {
    document.querySelectorAll('.section').forEach(s=>s.style.display='none');
    document.getElementById(section).style.display='block';
  };

  // --- Heures Sup ---
  const typesEvenement = ["Concert","R√©p√©tition","Autre"];
  function formatDuration(h,m){ return `${h}h${m.toString().padStart(2,'0')}`; }
  function calculateDuration(start,end){
    if(!start||!end) return "0h00";
    const [h1,m1]=start.split(":").map(Number);
    const [h2,m2]=end.split(":").map(Number);
    let total=(h2*60+m2)-(h1*60+m1); if(total<0) total=0;
    return formatDuration(Math.floor(total/60), total%60);
  }
  function updateDurHs(){
    let totalMins=0;
    document.querySelectorAll("#hsTable tbody tr").forEach(tr=>{
      const start=tr.querySelector(".debut").value;
      const end=tr.querySelector(".fin").value;
      const dur=calculateDuration(start,end);
      tr.querySelector(".duree").textContent=dur;
      const [h,m]=dur.split("h").map(Number);
      totalMins+=h*60+m;
    });
    document.getElementById("totalDuration").textContent=formatDuration(Math.floor(totalMins/60), totalMins%60);
  }
  function addRowHs(data={}){ const tbody=document.querySelector("#hsTable tbody"); const tr=document.createElement("tr");
    tr.innerHTML=`
      <td><input type="date" class="date" value="${data.date||''}"></td>
      <td><select class="type">${typesEvenement.map(t=>`<option value="${t}" ${t===data.type?'selected':''}>${t}</option>`).join('')}</select></td>
      <td><input type="time" class="debut" value="${data.debut||''}"></td>
      <td><input type="time" class="fin" value="${data.fin||''}"></td>
      <td class="duree">0h00</td>
      <td><input type="text" class="lieu" value="${data.lieu||''}"></td>
      <td><button type="button" class="deleteBtn">X</button></td>`;
    tbody.appendChild(tr);
    tr.querySelector(".debut").addEventListener("input",updateDurHs);
    tr.querySelector(".fin").addEventListener("input",updateDurHs);
    tr.querySelector(".deleteBtn").addEventListener("click",()=>{tr.remove();updateDurHs();});
    updateDurHs();
  }
  addRowHs();
  document.getElementById("addRowHs").addEventListener("click",()=>addRowHs());
  document.getElementById("sendHs").addEventListener("click", ()=>{
    const nomProfHs = document.getElementById("profNameHs").value.trim();
    if(!nomProfHs){ alert("Indiquez le nom complet du prof !"); return; }
    const tbody=document.querySelector("#hsTable tbody"); const lignes=[];
    tbody.querySelectorAll("tr").forEach(tr=>{
      lignes.push({
        date: tr.querySelector(".date").value,
        type: tr.querySelector(".type").value,
        debut: tr.querySelector(".debut").value,
        fin: tr.querySelector(".fin").value,
        duree: tr.querySelector(".duree").textContent,
        lieu: tr.querySelector(".lieu").value
      });
    });
    const total=document.getElementById("totalDuration").textContent;
    fetch("https://script.google.com/macros/s/AKfycbyM6rOwUI-pTFuA67NdqrpxHaOKN4-wWhABRzQvZn0oEDf8jFvperZ_sltTYJOkPYfA/exec",{method:"POST",body:JSON.stringify({nomProf:nomProfHs,lignes,total})})
      .then(res=>res.json()).then(res=>{
        document.getElementById("confirmHs").textContent=res.message;
        tbody.innerHTML=""; addRowHs(); document.getElementById("profNameHs").value="";
      }).catch(err=>{
        document.getElementById("confirmHs").textContent="Erreur : "+err;
      });
  });

  // --- Absences ---
  const salles = ["FM/Piano","Guitare","Batterie","Piano 2","Artistes","Salle des f√™tes Moult"];
  function addRowAbs(data={}) {
    const tbody=document.querySelector("#absTable tbody"); const tr=document.createElement("tr");
    tr.innerHTML=`
      <td><input type="date" class="dateAbs" value="${data.dateAbs||''}"></td>
      <td><input type="text" class="creneauAbs" value="${data.creneauAbs||''}"></td>
      <td><input type="date" class="dateRatt" value="${data.dateRatt||''}"></td>
      <td><input type="text" class="creneauRatt" value="${data.creneauRatt||''}"></td>
      <td><select class="salle">${salles.map(s=>`<option value="${s}" ${s===data.salle?'selected':''}>${s}</option>`).join('')}</select></td>
      <td><input type="checkbox" class="accord" ${data.accord?'checked':''}></td>
      <td><button type="button" class="deleteBtn">X</button></td>`;
    tbody.appendChild(tr);
    tr.querySelector(".deleteBtn").addEventListener("click",()=>tr.remove());
  }
  addRowAbs();
  document.getElementById("addRowAbs").addEventListener("click",()=>addRowAbs());
  document.getElementById("sendAbs").addEventListener("click",()=>{
    const nomProfAbs=document.getElementById("profNameAbs").value.trim();
    if(!nomProfAbs){alert("Indiquez le nom complet du prof !");return;}
    const tbody=document.querySelector("#absTable tbody"); const lignes=[];
    tbody.querySelectorAll("tr").forEach(tr=>{
      lignes.push({
        dateAbs: tr.querySelector(".dateAbs").value,
        creneauAbs: tr.querySelector(".creneauAbs").value,
        dateRatt: tr.querySelector(".dateRatt").value,
        creneauRatt: tr.querySelector(".creneauRatt").value,
        salle: tr.querySelector(".salle").value,
        accord: tr.querySelector(".accord").checked
      });
    });
    fetch("https://script.google.com/macros/s/AKfycbxj7wSGsKOPbtA2eEXuyQ1XFfT-9G0ztofgDUzvBI9GN0t_dvebEfUstWLKpO-rl9n6/exec",{method:"POST",body:JSON.stringify({nomProf:nomProfAbs,lignes})})
      .then(res=>res.json()).then(res=>{
        document.getElementById("confirmAbs").textContent=res.message;
        tbody.innerHTML=""; addRowAbs(); document.getElementById("profNameAbs").value="";
      }).catch(err=>{
        document.getElementById("confirmAbs").textContent="Erreur : "+err;
      });
  });

});
</script>

</body>
</html>
