<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Interface Professeur - POM Musique</title>
<style>
  body { margin:0; font-family:Arial,sans-serif; display:flex; height:100vh; }
  .sidebar {
    width:220px; background: linear-gradient(to bottom,#ffb629,#000000); color:white;
    display:flex; flex-direction:column; align-items:center; padding-top:20px;
  }
  .sidebar img { width:150px; margin-bottom:30px; }
  .menu-item {
    width:90%; padding:12px 10px; margin:5px 0; border-radius:8px;
    cursor:pointer; display:flex; align-items:center; transition: background 0.3s;
    font-size:16px; background-color:#ccc; color:#000;
  }
  .menu-item:hover { background-color:#bbb; }
  .menu-item span { margin-left:10px; }
  .content { flex:1; padding:20px; background-color:#f9f9f9; overflow-y:auto; }
</style>
</head>
<body>

<div class="sidebar">
  <img src="https://raw.githubusercontent.com/sebgohier/pommusique/refs/heads/main/Logo%20Pom%20Musique%20noir.png" alt="Logo POM Musique">

  <div class="menu-item" onclick="loadSection('https://raw.githubusercontent.com/sebgohier/pommusique/main/heures_sup.html')">‚è∞ <span>Heures sup</span></div>
  <div class="menu-item" onclick="loadSection('https://raw.githubusercontent.com/sebgohier/pommusique/main/absences.html')">üìù <span>Absences</span></div>
  <div class="menu-item">üìÅ <span>R√©pertoire √©l√®ves</span></div>
  <div class="menu-item">üìÖ <span>Planning</span></div>
  <div class="menu-item">üéº <span>Partitions</span></div>
  <div class="menu-item">üìû <span>Contacts</span></div>
</div>

<div class="content" id="content">
  <h2>Bienvenue sur l‚Äôinterface professeur POM Musique</h2>
  <p>Choisissez une section dans le menu √† gauche.</p>
</div>

<script>
function loadSection(fileUrl){
  fetch(fileUrl)
    .then(res => res.text())
    .then(html => {
      document.getElementById('content').innerHTML = html;
      initForms(); // R√©-initialise les scripts de formulaire apr√®s chargement
    })
    .catch(err => console.error("Erreur de chargement :", err));
}

function initForms(){
  // Heures sup
  const hsForm = document.getElementById("hsTable");
  if(hsForm){
    const typesEvenement = ["Concert","R√©p√©tition","Autre"];
    function formatDuration(h,m){ return `${h}h${m.toString().padStart(2,'0')}`; }
    function calculateDuration(start,end){
      if(!start||!end) return "0h00";
      const [h1,m1]=start.split(":").map(Number);
      const [h2,m2]=end.split(":").map(Number);
      let total = (h2*60+m2)-(h1*60+m1);
      if(total<0) total=0;
      const h=Math.floor(total/60); const m=total%60;
      return formatDuration(h,m);
    }
    function updateDurHs(){
      let totalMins=0;
      document.querySelectorAll("#hsTable tbody tr").forEach(tr=>{
        const start = tr.querySelector(".debut").value;
        const end = tr.querySelector(".fin").value;
        const durCell = tr.querySelector(".duree");
        const dur = calculateDuration(start,end);
        durCell.textContent=dur;
        const [h,m]=dur.split("h").map(Number);
        totalMins+=h*60+m;
      });
      document.getElementById("totalDuration").textContent=formatDuration(Math.floor(totalMins/60),totalMins%60);
    }
    function addRowHs(data={}) {
      const tbody=document.querySelector("#hsTable tbody");
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td><input type="date" class="date" value="${data.date||''}"></td>
        <td><select class="type">${typesEvenement.map(t=>`<option value="${t}" ${t===data.type?'selected':''}>${t}</option>`).join('')}</select></td>
        <td><input type="time" class="debut" value="${data.debut||''}"></td>
        <td><input type="time" class="fin" value="${data.fin||''}"></td>
        <td class="duree">0h00</td>
        <td><input type="text" class="lieu" value="${data.lieu||''}"></td>
        <td><button type="button" class="deleteBtn">X</button></td>
      `;
      tbody.appendChild(tr);
      tr.querySelector(".debut").addEventListener("input",updateDurHs);
      tr.querySelector(".fin").addEventListener("input",updateDurHs);
      tr.querySelector(".deleteBtn").addEventListener("click",()=>{tr.remove();updateDurHs();});
      updateDurHs();
    }
    addRowHs();
    document.getElementById("addRowHs").addEventListener("click",()=>addRowHs());

    document.getElementById("sendHs")?.addEventListener("click", ()=>{
      const lignes = [];
      document.querySelectorAll("#hsTable tbody tr").forEach(tr=>{
        lignes.push({
          date: tr.querySelector(".date").value,
          type: tr.querySelector(".type").value,
          debut: tr.querySelector(".debut").value,
          fin: tr.querySelector(".fin").value,
          duree: tr.querySelector(".duree").textContent,
          lieu: tr.querySelector(".lieu").value
        });
      });
      const total = document.getElementById("totalDuration").textContent;
      fetch("URL_WEBAPP_HEURES_SUP",{
        method:"POST",
        body: JSON.stringify({nomProf:"<?= nomProf ?>",lignes,total})
      }).then(r=>r.json()).then(res=>{
        alert(res.message);
      });
    });
  }

  // Absences
  const absForm = document.getElementById("absTable");
  if(absForm){
    const salles = ["FM/Piano","Guitare","Batterie","Piano 2","Artistes","Salle des f√™tes Moult"];
    function addRowAbs(data={}){
      const tbody=document.querySelector("#absTable tbody");
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td><input type="date" class="dateAbs" value="${data.dateAbs||''}"></td>
        <td><input type="text" class="creneauAbs" placeholder="16h30-18h30" value="${data.creneauAbs||''}"></td>
        <td><input type="date" class="dateRatt" value="${data.dateRatt||''}"></td>
        <td><input type="text" class="creneauRatt" placeholder="16h30-18h30" value="${data.creneauRatt||''}"></td>
        <td><select class="salle">${salles.map(s=>`<option value="${s}" ${s===data.salle?'selected':''}>${s}</option>`).join('')}</select></td>
        <td><input type="checkbox" class="accord" ${data.accord?'checked':''}></td>
        <td><button type="button" class="deleteBtn">X</button></td>
      `;
      tbody.appendChild(tr);
      tr.querySelector(".deleteBtn").addEventListener("click",()=>tr.remove());
    }
    addRowAbs();
    document.getElementById("addRowAbs").addEventListener("click",()=>addRowAbs());

    document.getElementById("sendAbs")?.addEventListener("click",()=>{
      const lignes=[];
      document.querySelectorAll("#absTable tbody tr").forEach(tr=>{
        lignes.push({
          dateAbs: tr.querySelector(".dateAbs").value,
          creneauAbs: tr.querySelector(".creneauAbs").value,
          dateRatt: tr.querySelector(".dateRatt").value,
          creneauRatt: tr.querySelector(".creneauRatt").value,
          salle: tr.querySelector(".salle").value,
          accord: tr.querySelector(".accord").checked
        });
      });
      fetch("URL_WEBAPP_ABSENCES",{
        method:"POST",
        body: JSON.stringify({nomProf:"<?= nomProf ?>",lignes})
      }).then(r=>r.json()).then(res=>{
        alert(res.message);
      });
    });
  }
}

// Charge la page d'accueil par d√©faut
document.getElementById('content').innerHTML = '<h2>Bienvenue sur l‚Äôinterface professeur POM Musique</h2><p>Choisissez une section dans le menu √† gauche.</p>';
</script>

</body>
</html>
